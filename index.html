<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mini Fortnite Game</title>
<style>
  body { margin: 0; overflow: hidden; }
  canvas { display: block; }
</style>
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/three@0.154.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.154.0/examples/js/controls/PointerLockControls.js"></script>

<script>
let scene, camera, renderer, controls;
let bullets = [];
let objects = [];
let velocity = new THREE.Vector3();
let direction = new THREE.Vector3();
let canJump = false;
let moveForward = false, moveBackward = false, moveLeft = false, moveRight = false;

// Scene setup
scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb); // sky blue

camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.y = 2;

// Renderer
renderer = new THREE.WebGLRenderer({antialias: true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// Controls
controls = new THREE.PointerLockControls(camera, document.body);
document.body.addEventListener('click', () => { controls.lock(); });

// Floor
const floorGeometry = new THREE.BoxGeometry(50, 1, 50);
const floorMaterial = new THREE.MeshPhongMaterial({color: 0x228B22});
const floor = new THREE.Mesh(floorGeometry, floorMaterial);
floor.position.y = -0.5;
scene.add(floor);
objects.push(floor);

// Walls
function addWall(x, z) {
  const wallGeo = new THREE.BoxGeometry(1, 3, 5);
  const wallMat = new THREE.MeshPhongMaterial({color: 0x8B4513});
  const wall = new THREE.Mesh(wallGeo, wallMat);
  wall.position.set(x, 1.5, z);
  scene.add(wall);
  objects.push(wall);
}
addWall(5, 0);
addWall(-5, -5);
addWall(0, 5);

// Lights
const light = new THREE.DirectionalLight(0xffffff, 1);
light.position.set(10, 20, 10);
scene.add(light);

const ambient = new THREE.AmbientLight(0xffffff, 0.3);
scene.add(ambient);

// Movement controls
const onKeyDown = function(e) {
  switch(e.code) {
    case 'ArrowUp':
    case 'KeyW': moveForward = true; break;
    case 'ArrowLeft':
    case 'KeyA': moveLeft = true; break;
    case 'ArrowDown':
    case 'KeyS': moveBackward = true; break;
    case 'ArrowRight':
    case 'KeyD': moveRight = true; break;
    case 'Space':
      if (canJump) { velocity.y += 7; canJump = false; }
      break;
  }
};
const onKeyUp = function(e) {
  switch(e.code) {
    case 'ArrowUp':
    case 'KeyW': moveForward = false; break;
    case 'ArrowLeft':
    case 'KeyA': moveLeft = false; break;
    case 'ArrowDown':
    case 'KeyS': moveBackward = false; break;
    case 'ArrowRight':
    case 'KeyD': moveRight = false; break;
  }
};
document.addEventListener('keydown', onKeyDown);
document.addEventListener('keyup', onKeyUp);

// Shooting
document.addEventListener('click', () => {
  const bulletGeo = new THREE.SphereGeometry(0.1, 8, 8);
  const bulletMat = new THREE.MeshBasicMaterial({color: 0xff0000});
  const bullet = new THREE.Mesh(bulletGeo, bulletMat);
  bullet.position.copy(camera.position);
  bullet.quaternion.copy(camera.quaternion);
  bullets.push(bullet);
  scene.add(bullet);
});

// Animation loop
const clock = new THREE.Clock();
function animate() {
  requestAnimationFrame(animate);
  const delta = clock.getDelta();

  // Movement
  velocity.x -= velocity.x * 10.0 * delta;
  velocity.z -= velocity.z * 10.0 * delta;
  velocity.y -= 9.8 * 5.0 * delta; // gravity

  direction.z = Number(moveForward) - Number(moveBackward);
  direction.x = Number(moveRight) - Number(moveLeft);
  direction.normalize();

  if (moveForward || moveBackward) velocity.z -= direction.z * 50.0 * delta;
  if (moveLeft || moveRight) velocity.x -= direction.x * 50.0 * delta;

  controls.moveRight(-velocity.x * delta);
  controls.moveForward(-velocity.z * delta);
  camera.position.y += velocity.y * delta;

  if (camera.position.y < 2) { velocity.y = 0; camera.position.y = 2; canJump = true; }

  // Update bullets
  bullets.forEach((b, i) => {
    const forward = new THREE.Vector3(0,0,-1).applyQuaternion(b.quaternion);
    b.position.add(forward.multiplyScalar(20 * delta));

    // Remove bullets far away
    if (b.position.length() > 100) {
      scene.remove(b);
      bullets.splice(i,1);
    }
  });

  renderer.render(scene, camera);
}
animate();

// Resize
window.addEventListener('resize', () => {
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>

